# -*- coding: utf-8 -*-
"""AttritionModel.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1AXl3lE9zVlJa4Cphwt66jOD4c6Qw7KOF
"""

import pandas as pd

df = pd.read_csv("data_with_nan.csv")
df

df = df.drop('Attrition', axis=1)
df

data_selected = df[['MonthlyIncome', 'TotalWorkingYears', 'YearsAtCompany', 'YearsInCurrentRole',
                      'YearsWithCurrManager', 'Age', 'OverTime', 'DistanceFromHome', 'StockOptionLevel',
                      'JobLevel', 'JobRole', 'WorkLifeBalance', 'Gender', 'JobSatisfaction', 'MaritalStatus']]

data_selected.head()

import joblib

best_model = joblib.load('best_model.joblib')
print("Model 'best_model.joblib' berhasil dimuat.")

from sklearn import preprocessing
import pandas as pd

cat_one_hot = ['OverTime', 'Gender', 'MaritalStatus']
cat_labeling = ['JobLevel', 'JobRole', 'JobSatisfaction', 'WorkLifeBalance', 'StockOptionLevel']

df_processed = data_selected.copy(deep=True)

# Gunakan One-Hot Encoding dengan drop_first=True
df_processed = pd.get_dummies(df_processed, columns=cat_one_hot, drop_first=True)

# Gunakan Label Encoding untuk kolom kategori lainnya
for col in cat_labeling:
    df_processed[col] = df_processed[col].astype(str)
    le = preprocessing.LabelEncoder()
    df_processed[col] = le.fit_transform(df_processed[col])
    print(f'Feature {col} (Label Encoded)')
    print(f'mapping {dict(zip(le.classes_, le.transform(le.classes_)))}')

# Feature untuk best model yang akan ditrain
if hasattr(best_model, 'feature_names_in_'):
    model_features = list(best_model.feature_names_in_)
    missing_cols = set(model_features) - set(df_processed.columns)
    for col in missing_cols:
        df_processed[col] = 0
    extra_cols = set(df_processed.columns) - set(model_features)
    df_processed = df_processed.drop(columns=list(extra_cols))
    df_labeling = df_processed[model_features]
else:
    print("Warning: Model does not expose 'feature_names_in_'. Proceeding without explicit feature alignment. This might lead to errors if feature order/existence doesn't match model training.")
    df_labeling = df_processed

print(f"Shape of df_labeling: {df_labeling.shape}")

# Melakukan prediksi dengan best model
predictions = best_model.predict(df_labeling)

# menambahkan kolom Attrition pada data
df['Attrition'] = predictions

print("Prediksi Attrition berhasil ditambahkan sebagai kolom baru ke 'data_selected'.")
df.head()

data_without_nan = pd.read_csv("data_without_nan.csv")

data = pd.concat([df, data_without_nan])
data.head()

data

data.to_csv("data_employee.csv")

